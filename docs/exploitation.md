# Documentation d’Exploitation

## Connexion VPN

- Démarrer le service WireGuard :

```bash
  sudo systemctl start wg-quick@wg0
```

- Arrêté le service WireGuard :

```bash
  sudo systemctl stop wg-quick@wg0
```

- Vérifier l’état du VPN :

```bash
sudo wg
ip a show wg0
```

## Montage du partage

Sur la VM cliente, créer un point de montage local :

```bash
mkdir /mnt/nas
mount -t cifs //10.0.0.1/partage /mnt/nas -o username=erwan,password=erwan
```

## Envoyer un fichier vers la VM NAS
Créer un fichier de test :

```bash
echo "Bonjour depuis la VM cliente" > /mnt/nas/test.txt
```
Ce fichier est maintenant visible sur la NAS dans /srv/partage/test.txt.

## Télécharger un fichier depuis la VM NAS

Supposons qu’un fichier readme.md se trouve déjà dans /srv/partage sur la NAS.

Depuis la VM cliente, copier le fichier vers un dossier local :

```bash
cp /mnt/nas/readme.md ~/readme_nas.md
```

## Démonter le partage (quand tu as fini)

```bash
umount /mnt/nas
```
Pourquoi démonter le partage réseau (umount /mnt/nas) ?
1. Libérer les ressources système
Quand tu montes un partage Samba, le système maintient une connexion active au serveur NAS. Si tu ne démontes pas :

la connexion reste ouverte inutilement,

cela consomme de la RAM et des sockets réseau.

2. Éviter des erreurs en cas de perte de connexion
Si la connexion VPN tombe ou que la NAS redémarre, alors :

le montage /mnt/nas devient inaccessible,

toute tentative de lecture/écriture dans ce dossier provoque des erreurs ou blocages.

En démontant proprement, tu évites ce problème.

3. Sécurité
Si plusieurs utilisateurs utilisent la même VM cliente :

le dossier /mnt/nas reste monté et accessible à tous tant qu’il n’est pas démonté.

démonter évite les accès non autorisés ou accidentels.

4. Bonne pratique dans les scripts/automatisations
Dans un script de sauvegarde, par exemple, on :

monte le partage,

transfère les fichiers,

démonte proprement.

Ça garantit un comportement propre et prévisible.

## Sauvegarde

```bash
tar -czf /mnt/nas/backup_home.tar.gz /home/erwan
```

## Restauration

```bash
tar -xzf /mnt/nas/backup_home.tar.gz -C /home/erwan_restauré/
```

## À quoi ça sert ?

Ces commandes servent à sauvegarder et à restaurer le dossier personnel d’un utilisateur (/home/erwan) sur le serveur NAS, via le partage réseau monté dans /mnt/nas.

- SAUVEGARDE
```bash
tar -czf /mnt/nas/backup_home.tar.gz /home/erwan
```

  - Traduction :
« Crée une archive compressée de tout le dossier /home/erwan et enregistre cette archive dans /mnt/nas sous le nom backup_home.tar.gz. »

tar : l'outil d'archivage

-c : crée une nouvelle archive

-z : la compresse avec gzip (fichier .tar.gz)

-f : nom du fichier de sortie

/mnt/nas/backup_home.tar.gz : l'archive de sauvegarde va sur le NAS

/home/erwan : le dossier à sauvegarder

  - Cela permet de sauvegarder tous tes fichiers utilisateurs dans un seul fichier compressé, transféré directement sur le NAS.

- RESTAURATION

```bash
tar -xzf /mnt/nas/backup_home.tar.gz -C /home/erwan_restauré/
```
  - Traduction :
« Décompresse et extrait l’archive backup_home.tar.gz depuis le NAS dans un nouveau dossier /home/erwan_restauré/. »

-x : extrait une archive

-z : utilise gzip pour décompresser

-f : fichier à extraire

-C /home/erwan_restauré/ : indique où extraire les fichiers

- Cela permet de restaurer les données sauvegardées, par exemple en cas de perte, de formatage ou de test.

